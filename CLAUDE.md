# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºŽPythonçš„ç”µåŠ¨æ±½è½¦å……ç”µç«™(EVCS)åšå¼ˆè®ºä»¿çœŸé¡¹ç›®ã€‚**æ ¸å¿ƒç›®æ ‡æ˜¯æ±‚è§£ç”µåŠ¨æ±½è½¦å……ç”µç«™ä»·æ ¼åšå¼ˆä¸­çš„å‡è¡¡è§£**ã€‚

é¡¹ç›®åŒ…å«ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š
1. **åšå¼ˆçŽ¯å¢ƒå®žçŽ°**ï¼šå»ºæ¨¡ç”¨æˆ·å‡è¡¡åŠ¨æ€äº¤é€šåˆ†é…(UE-DTA)ä¸Žå……ç”µç«™å®šä»·ç«žäº‰çš„ä»¿çœŸçŽ¯å¢ƒ
2. **MADRLç®—æ³•å®žçŽ°**ï¼šåŸºäºŽMADDPGæ”¹é€ çš„å¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼Œç”¨äºŽæ±‚è§£ä»·æ ¼å‡è¡¡

## å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œä¸»ä»¿çœŸ
python main.py

# è¿è¡ŒæŠ€æœ¯éªŒè¯æµ‹è¯•
python src/technical_validation.py
```

## æ ¸å¿ƒæž¶æž„ä¸Žæ–‡ä»¶ç»“æž„

### ä¸»è¦ç»„ä»¶

- **`src/EVCSChargingGameEnv.py`**: **v3.0æ ¸å¿ƒçŽ¯å¢ƒå®žçŽ°** (å¼€å‘ä¸­)
  - åŸºäºŽv2æ¡†æž¶ + è‡ªçŽ¯å……ç”µé“¾è·¯ + é¢„å®šè·¯å¾„çš„æœ€ç»ˆè®¾è®¡æ–¹æ¡ˆ
  - å®Œæ•´PettingZoo ParallelEnvæŽ¥å£
  - é›†æˆPredefinedRouteVehicle + å¤šçŠ¶æ€å›¾è·¯å¾„ç®—æ³•

- **`src/EVCSChargingGameEnv_v1.py`**: v1.0ç‰ˆæœ¬å®žçŽ°
  - åŸºäºŽå……ç”µé“¾è·¯å¤åˆ¶çš„åˆå§‹æ–¹æ¡ˆ
  - å®Œæ•´çš„UE-DTAå’Œå¤šæ™ºèƒ½ä½“æŽ¥å£
  - å·²éªŒè¯çš„day-to-dayåŠ¨æ€å‡è¡¡ç®—æ³•

- **`src/EVCSChargingGameEnv_v2.py`**: v2.0ç‰ˆæœ¬å®žçŽ°
  - åŸºäºŽèŠ‚ç‚¹åˆ†ç¦»çš„å®Œæ•´æ¡†æž¶è®¾è®¡
  - v3.0ç»§æ‰¿å…¶PettingZooæŽ¥å£å’ŒUE-DTAç®—æ³•æ¡†æž¶
  - æä¾›v3.0çš„æ•´ä½“ç»“æž„åŸºç¡€

- **`src/technical_validation.py`**: æŠ€æœ¯éªŒè¯è„šæœ¬
  - PredefinedRouteVehicleå’ŒPredefinedRouteWorldç±»å®žçŽ°
  - UXSimè‡ªçŽ¯é“¾è·¯å…¼å®¹æ€§éªŒè¯
  - è·¯å¾„æ‰§è¡Œå®Œæ•´æ€§æµ‹è¯•

- **`main.py`**: ç®€å•å…¥å£ç‚¹ï¼Œåˆå§‹åŒ–çŽ¯å¢ƒ

### ç½‘ç»œæ•°æ®ç»“æž„

ä»¿çœŸä½¿ç”¨å­˜å‚¨åœ¨ `siouxfalls/` ä¸­çš„Sioux Fallsç½‘ç»œæ•°æ®ï¼š
- `siouxfalls_nodes.csv`: å¸¦åæ ‡çš„ç½‘ç»œèŠ‚ç‚¹
- `siouxfalls_links.csv`: å¸¦å®¹é‡å’Œé€Ÿåº¦å‚æ•°çš„é“è·¯é“¾è·¯
- `siouxfalls_demand.csv`: èµ·ç»ˆç‚¹å¯¹ä¹‹é—´çš„äº¤é€šéœ€æ±‚
- `siouxfalls_settings.json`: é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬å……ç”µèŠ‚ç‚¹å’Œä»·æ ¼è¾¹ç•Œ

## EVCSChargingGameEnv v3.0 è®¾è®¡æ–¹æ¡ˆ

### ðŸŽ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ

**æ•´ä½“æž¶æž„**: ç»§æ‰¿v2æ¡†æž¶ï¼ˆPettingZooæŽ¥å£ + UE-DTAç®—æ³• + ç±»ç»“æž„ï¼‰
**å……ç”µå»ºæ¨¡**: è‡ªçŽ¯å……ç”µé“¾è·¯ + å¤šçŠ¶æ€å›¾è·¯å¾„ç®—æ³• + PredefinedRouteVehicleä¸¥æ ¼æ‰§è¡Œ

**è®¾è®¡åŽŸåˆ™**:
1. **æ¡†æž¶ç»§æ‰¿**: é‡‡ç”¨v2ç‰ˆæœ¬çš„æˆç†ŸPettingZooæŽ¥å£å’ŒUE-DTAæ¡†æž¶
2. **æ‹“æ‰‘ç®€åŒ–**: ä½¿ç”¨è‡ªçŽ¯å……ç”µé“¾è·¯ï¼Œé¿å…èŠ‚ç‚¹åˆ†ç¦»çš„ç½‘ç»œå¤æ‚æ€§
3. **è·¯å¾„ç²¾ç¡®æŽ§åˆ¶**: å¤šçŠ¶æ€å›¾ç¡®ä¿å……ç”µè½¦è¾†æ°å¥½å……ç”µä¸€æ¬¡
4. **æ‰§è¡Œä¿è¯**: PredefinedRouteVehicleç¡®ä¿ä¸¥æ ¼æŒ‰é¢„å®šè·¯å¾„è¡Œé©¶

### ðŸ§ª æŠ€æœ¯éªŒè¯ç»“æžœ

#### âœ… UXSimè‡ªçŽ¯é“¾è·¯å®Œå…¨å…¼å®¹
åŸºäºŽ `src/technical_validation.py` çš„éªŒè¯æµ‹è¯•è¡¨æ˜Žï¼š

```python
# æµ‹è¯•è·¯å¾„ï¼ˆåŒ…å«è‡ªçŽ¯A-Aï¼‰
predefined_route = ["A-B", "B-A", "A-A", "A-B", "B-A", "A-C"]

# éªŒè¯ç»“æžœ
Actual route:     ['A-B', 'B-A', 'A-A', 'A-B', 'B-A', 'A-C'] 
Predefined route: ['A-B', 'B-A', 'A-A', 'A-B', 'B-A', 'A-C']
Completion progress: 100.0%
Unfinished vehicles: 0
```

#### âœ… PredefinedRouteVehicleå…³é”®ç‰¹æ€§
1. **100%è·¯å¾„åŒ¹é…**: å®žé™…è¡Œé©¶è·¯å¾„ä¸Žé¢„å®šè·¯å¾„å®Œå…¨ä¸€è‡´
2. **è‡ªçŽ¯æ”¯æŒ**: UXSimåŽŸç”Ÿæ”¯æŒè‡ªçŽ¯é“¾è·¯ï¼ˆX-Xæ ¼å¼ï¼‰
3. **å®ŒæˆçŽ‡ä¿è¯**: æ‰€æœ‰è½¦è¾†æŒ‰é¢„å®šè·¯å¾„å®Œæˆè¡Œç¨‹
4. **è·¯å¾„çµæ´»æ€§**: æ”¯æŒä»»æ„å¤æ‚çš„è·¯å¾„åºåˆ—ï¼ŒåŒ…æ‹¬è‡ªçŽ¯

### ðŸ—ï¸ v3.0æž¶æž„è®¾è®¡

#### 1. è‡ªçŽ¯å……ç”µé“¾è·¯åˆ›å»º
```python
# ä¸ºæ¯ä¸ªå……ç”µèŠ‚ç‚¹åˆ›å»ºè‡ªçŽ¯å……ç”µé“¾è·¯
def _create_charging_links(self):
    for charging_node_idx in self._charging_nodes.keys():
        charging_link_name = f"charging_{charging_node_idx}"
        self.W.addLink(
            name=charging_link_name,
            start_node=charging_node_idx,
            end_node=charging_node_idx,  # è‡ªçŽ¯ï¼šèµ·ç‚¹=ç»ˆç‚¹
            length=self._charging_link_length,
            free_flow_speed=self._charging_link_free_flow_speed,
            attribute={"charging_link": True}
        )
```

#### 2. å¤šçŠ¶æ€å›¾è·¯å¾„ç®—æ³•
```python
def _enumerate_k_shortest_charge_routes(self, source, target, k):
    """åŸºäºŽå¤šçŠ¶æ€å›¾çš„å……ç”µè·¯å¾„æžšä¸¾ï¼Œç¡®ä¿æ°å¥½ä¸€æ¬¡å……ç”µ"""
    G = nx.DiGraph()
    
    # æž„å»ºå¤šçŠ¶æ€å›¾
    for link in self.W.LINKS:
        start, end = link.start_node.name, link.end_node.name
        
        if link.attribute.get("charging_link", False):
            # è‡ªçŽ¯å……ç”µé“¾è·¯ï¼šçŠ¶æ€è½¬æ¢ uncharged -> charged
            node_idx = start  # è‡ªçŽ¯èµ·ç‚¹=ç»ˆç‚¹
            G.add_edge(f"uncharged_{node_idx}", f"charged_{node_idx}", 
                      weight=link.length/link.u, link_name=link.name)
        else:
            # æ™®é€šé“¾è·¯ï¼šçŠ¶æ€ä¿æŒ
            G.add_edge(f"uncharged_{start}", f"uncharged_{end}", 
                      weight=link.length/link.u, link_name=link.name)
            G.add_edge(f"charged_{start}", f"charged_{end}", 
                      weight=link.length/link.u, link_name=link.name)
    
    # è·¯å¾„æœç´¢ï¼šuncharged_source -> charged_target
    paths = nx.shortest_simple_paths(G, f"uncharged_{source}", f"charged_{target}", weight='weight')
    
    # è½¬æ¢ä¸ºå®žé™…é“¾è·¯åºåˆ—ï¼Œä¾›PredefinedRouteVehicleä½¿ç”¨
    routes = []
    for path in islice(paths, k):
        route = [G[path[i]][path[i+1]]['link_name'] for i in range(len(path)-1)]
        routes.append(route)
    
    return routes
```

#### 3. PredefinedRouteVehicleé›†æˆ
```python
# ç»§æ‰¿v2æ¡†æž¶ï¼Œé›†æˆé¢„å®šè·¯å¾„è½¦è¾†
class EVCSGameEnv(ParallelEnv):  # ç»§æ‰¿v2çš„åŸºç¡€ç»“æž„
    def _create_simulation_world(self):
        """åˆ›å»ºæ”¯æŒé¢„å®šè·¯å¾„çš„ä»¿çœŸä¸–ç•Œ"""
        W = PredefinedRouteWorld(name="EVCS_Simulation", **simulation_params)
        
        # å¤åˆ¶ç½‘ç»œç»“æž„ï¼ˆåŒ…æ‹¬è‡ªçŽ¯å……ç”µé“¾è·¯ï¼‰
        self._copy_network_to_world(W)
        
        # ä¸ºæ¯è¾†è½¦åˆ†é…é¢„å®šè·¯å¾„
        for vehicle_id, route_links in self.routes_specified.items():
            veh = W.addVehicle(
                predefined_route=route_links,  # å®Œæ•´é“¾è·¯åºåˆ—ï¼ŒåŒ…å«è‡ªçŽ¯charging_links
                departure_time=self.departure_times[vehicle_id],
                name=vehicle_id
            )
```

#### 4. å……ç”µè¡Œä¸ºç‰©ç†å»ºæ¨¡
```python
# é€šè¿‡è‡ªçŽ¯é“¾è·¯å‚æ•°æŽ§åˆ¶å……ç”µæ—¶é—´ï¼ˆä»…ä½¿ç”¨settings.jsonä¸­é…ç½®çš„å‚æ•°ï¼‰
charging_link_parameters = {
    "length": 3000,              # 3kmï¼Œæ¥è‡ªsettings.jsonçš„charging_link_length
    "free_flow_speed": 10,       # 10m/sï¼Œæ¥è‡ªsettings.jsonçš„charging_link_free_flow_speed
}
```

### ðŸŽ® PettingZooçŽ¯å¢ƒæŽ¥å£è®¾è®¡ï¼ˆç»§æ‰¿v2æ¡†æž¶ï¼‰

#### è§‚æµ‹ç©ºé—´
```python
def observation_space(self, agent):
    return spaces.Dict({
        "last_round_all_prices": spaces.Box(low=0.0, high=1.0, shape=(self.n_agents, self.n_periods)),
        "own_charging_flow": spaces.Box(low=0, high=np.inf, shape=(self.n_periods,))
    })
```

#### åŠ¨ä½œç©ºé—´
```python
def action_space(self, agent):
    return spaces.Box(low=0.0, high=1.0, shape=(self.n_periods,))
```

#### å¥–åŠ±å‡½æ•°
```python
reward_i = Î£(æ—¶æ®µ_jçš„ä»·æ ¼ Ã— æ—¶æ®µ_jçš„å……ç”µè½¦è¾†æ•°é‡)  # å¯¹äºŽæ™ºèƒ½ä½“i
```

### ðŸ“Š Day-to-DayåŠ¨æ€å‡è¡¡ç®—æ³•ï¼ˆç»§æ‰¿v2æ¡†æž¶ï¼‰

#### UE-DTAæ±‚è§£æµç¨‹
1. **è·¯å¾„é¢„è®¡ç®—**: ä½¿ç”¨å¤šçŠ¶æ€å›¾ä¸ºæ‰€æœ‰ODå¯¹é¢„è®¡ç®—kæ¡å……ç”µ/éžå……ç”µè·¯å¾„
2. **è·¯å¾„åˆå§‹åŒ–**: ä¸ºè½¦è¾†åˆ†é…åˆå§‹é¢„å®šè·¯å¾„ï¼ˆå……ç”µè½¦è¾†ç¡®ä¿åŒ…å«æ°å¥½ä¸€æ¡è‡ªçŽ¯å……ç”µé“¾è·¯ï¼‰
3. **ä»¿çœŸæ‰§è¡Œ**: ä½¿ç”¨PredefinedRouteVehicleä¸¥æ ¼æŒ‰é¢„å®šè·¯å¾„ä»¿çœŸ
4. **æˆæœ¬è®¡ç®—**: åŸºäºŽå®žé™…æ—…è¡Œæ—¶é—´å’Œå……ç”µä»·æ ¼è®¡ç®—æ€»æˆæœ¬
5. **è·¯å¾„åˆ‡æ¢**: æ ¹æ®æˆæœ¬å·®å¼‚å’Œéšæœºæ¦‚çŽ‡è¿›è¡Œè·¯å¾„è°ƒæ•´
6. **æ”¶æ•›åˆ¤æ–­**: åŸºäºŽå¹³å‡æˆæœ¬å·®åˆ¤æ–­æ˜¯å¦è¾¾åˆ°å‡è¡¡

#### æˆæœ¬å‡½æ•°
```python
# å……ç”µè½¦è¾†ï¼ˆæ£€æµ‹åˆ°è‡ªçŽ¯charging_é“¾è·¯ï¼‰
æ€»æˆæœ¬ = time_value_coefficient Ã— å®žé™…æ—…è¡Œæ—¶é—´ + å……ç”µä»·æ ¼ Ã— charging_demand_per_vehicle

# éžå……ç”µè½¦è¾†  
æ€»æˆæœ¬ = time_value_coefficient Ã— å®žé™…æ—…è¡Œæ—¶é—´
```

## ðŸ“‹ v3.0å®žçŽ°TODOæ¸…å•

### ðŸ Phase 1: çŽ¯å¢ƒæ¡†æž¶æ­å»ºï¼ˆç»§æ‰¿v2ï¼Œé¢„è®¡1å¤©ï¼‰âœ… **å·²å®Œæˆ**
- [x] **1.1 å¤åˆ¶v2åŸºç¡€æ¡†æž¶**
  - [x] ä»ŽEVCSChargingGameEnv_v2.pyå¤åˆ¶ç±»ç»“æž„å’ŒPettingZooæŽ¥å£
  - [x] ä¿ç•™observation_space, action_space, reset, stepç­‰æ ¸å¿ƒæ–¹æ³•æ¡†æž¶
  - [x] ä¿ç•™UE-DTAç®—æ³•çš„åŸºç¡€ç»“æž„å’Œå‚æ•°ç®¡ç†

- [x] **1.2 é›†æˆPredefinedRouteVehicle**
  - [x] ä»Žtechnical_validation.pyå¤åˆ¶PredefinedRouteVehicleå’ŒPredefinedRouteWorldç±»
  - [x] é€‚é…åˆ°EVCSGameEnvçš„ç½‘ç»œåˆ›å»ºå’Œè½¦è¾†ç®¡ç†æµç¨‹
  - [x] æ”¯æŒå»¶è¿Ÿè·¯å¾„åˆ†é…å’ŒLinkå¯¹è±¡åˆ—è¡¨è½¬æ¢

### ðŸ”— Phase 2: è‡ªçŽ¯å……ç”µé“¾è·¯å®žçŽ°ï¼ˆé¢„è®¡1å¤©ï¼‰âœ… **å·²å®Œæˆ**
- [x] **2.1 ç½‘ç»œåŠ è½½ä¸Žè‡ªçŽ¯é“¾è·¯åˆ›å»º**
  - [x] ä¿®æ”¹ç½‘ç»œåŠ è½½é€»è¾‘ï¼Œç§»é™¤èŠ‚ç‚¹åˆ†ç¦»ç›¸å…³ä»£ç 
  - [x] å®žçŽ°è‡ªçŽ¯å……ç”µé“¾è·¯åˆ›å»ºï¼šcharging_idx (idx->idx)
  - [x] è®¾ç½®å……ç”µé“¾è·¯ç‰©ç†å‚æ•°ï¼ˆä»…ä½¿ç”¨settings.jsoné…ç½®ï¼‰

- [x] **2.2 ç½‘ç»œéªŒè¯**
  - [x] éªŒè¯è‡ªçŽ¯å……ç”µé“¾è·¯æ­£ç¡®åˆ›å»º
  - [x] ç¡®è®¤UXSimå¯¹è‡ªçŽ¯é“¾è·¯çš„å…¼å®¹æ€§
  - [x] æµ‹è¯•åŸºç¡€ç½‘ç»œè¿žé€šæ€§

### ðŸ›£ï¸ Phase 3: å¤šçŠ¶æ€å›¾è·¯å¾„ç®—æ³•ï¼ˆé¢„è®¡2å¤©ï¼‰âœ… **å·²å®Œæˆ**
- [x] **3.1 å¤šçŠ¶æ€å›¾æž„å»º**
  - [x] å®žçŽ°uncharged/chargedçŠ¶æ€èŠ‚ç‚¹ç”Ÿæˆ
  - [x] æ™®é€šé“¾è·¯ï¼šçŠ¶æ€ä¿æŒè¾¹ï¼ˆuncharged->uncharged, charged->chargedï¼‰
  - [x] å……ç”µé“¾è·¯ï¼šçŠ¶æ€è½¬æ¢è¾¹ï¼ˆuncharged->chargedï¼‰

- [x] **3.2 å……ç”µè·¯å¾„æžšä¸¾ç®—æ³•**
  - [x] å®žçŽ°__enumerate_k_shortest_charge_routesæ–¹æ³•
  - [x] è·¯å¾„æœç´¢ï¼šuncharged_sourceåˆ°charged_target
  - [x] å¤šçŠ¶æ€å›¾è·¯å¾„è½¬æ¢ä¸ºå®žé™…é“¾è·¯åºåˆ—

- [x] **3.3 éžå……ç”µè·¯å¾„æžšä¸¾ç®—æ³•**
  - [x] å®žçŽ°__enumerate_k_shortest_routesæ–¹æ³•ï¼ˆæŽ’é™¤å……ç”µé“¾è·¯ï¼‰
  - [x] ç¡®ä¿éžå……ç”µè½¦è¾†ä¸ä¼šç»è¿‡charging_é“¾è·¯

### ðŸš— Phase 4: è·¯å¾„åˆ†é…ä¸Žè½¦è¾†ç®¡ç†ï¼ˆé¢„è®¡2å¤©ï¼‰
- [ ] **4.1 è·¯å¾„é¢„è®¡ç®—ä¸Žç¼“å­˜**
  - [ ] ä¸ºæ‰€æœ‰ODå¯¹é¢„è®¡ç®—å……ç”µå’Œéžå……ç”µè·¯å¾„é›†åˆ
  - [ ] å®žçŽ°è·¯å¾„ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è®¡ç®—
  - [ ] éªŒè¯è·¯å¾„è´¨é‡ï¼šè¿žé€šæ€§ã€å……ç”µé“¾è·¯åŒ…å«æ€§ç­‰

- [ ] **4.2 è½¦è¾†åˆ†ç±»ä¸Žè·¯å¾„åˆ†é…**
  - [ ] åŸºäºŽcharging_car_rateè¿›è¡Œè½¦è¾†åˆ†ç±»
  - [ ] ä¸ºå……ç”µè½¦è¾†åˆ†é…åŒ…å«æ°å¥½ä¸€æ¡è‡ªçŽ¯å……ç”µé“¾è·¯çš„è·¯å¾„
  - [ ] ä¸ºéžå……ç”µè½¦è¾†åˆ†é…æ™®é€šæœ€çŸ­è·¯å¾„

- [ ] **4.3 PredefinedRouteVehicleè½¦è¾†åˆ›å»º**
  - [ ] åœ¨_create_simulation_worldä¸­é›†æˆé¢„å®šè·¯å¾„è½¦è¾†åˆ›å»º
  - [ ] ç¡®ä¿æ¯è¾†è½¦èŽ·å¾—å®Œæ•´çš„é¢„å®šè·¯å¾„åºåˆ—
  - [ ] æµ‹è¯•è½¦è¾†æŒ‰é¢„å®šè·¯å¾„ä¸¥æ ¼æ‰§è¡Œ

### âš–ï¸ Phase 5: UE-DTAä»¿çœŸé›†æˆï¼ˆé¢„è®¡2å¤©ï¼‰
- [ ] **5.1 Worldå®žä¾‹ç®¡ç†**
  - [ ] æ¯stepåˆ›å»ºæ–°PredefinedRouteWorldå®žä¾‹
  - [ ] å¤åˆ¶ç½‘ç»œç»“æž„ï¼ˆåŒ…æ‹¬è‡ªçŽ¯å……ç”µé“¾è·¯ï¼‰åˆ°æ–°World
  - [ ] åº”ç”¨å½“å‰å……ç”µä»·æ ¼åˆ°è‡ªçŽ¯å……ç”µé“¾è·¯

- [ ] **5.2 Day-to-dayå‡è¡¡è¿­ä»£**
  - [ ] å®žçŽ°UEè¿­ä»£å¾ªçŽ¯æ¡†æž¶
  - [ ] æˆæœ¬è®¡ç®—ï¼šè¯†åˆ«è‡ªçŽ¯å……ç”µé“¾è·¯ï¼Œåº”ç”¨å……ç”µä»·æ ¼
  - [ ] è·¯å¾„åˆ‡æ¢é€»è¾‘ï¼šåŸºäºŽæˆæœ¬å·®å¼‚çš„éšæœºåˆ‡æ¢
  - [ ] æ”¶æ•›åˆ¤æ–­ï¼šå¹³å‡æˆæœ¬å·®å°äºŽé˜ˆå€¼

### ðŸ“Š Phase 6: å……ç”µæµé‡ç»Ÿè®¡ä¸Žå¥–åŠ±è®¡ç®—ï¼ˆé¢„è®¡1å¤©ï¼‰
- [ ] **6.1 è‡ªçŽ¯å……ç”µé“¾è·¯æ£€æµ‹**
  - [ ] ä»Žvehicle.traveled_route()è¯†åˆ«charging_é“¾è·¯è®¿é—®
  - [ ] æå–å……ç”µæ—¶åˆ»å’Œå……ç”µèŠ‚ç‚¹ä¿¡æ¯
  - [ ] æŒ‰æ—¶æ®µåˆ†ç»„ç»Ÿè®¡å„å……ç”µç«™æµé‡

- [ ] **6.2 å¥–åŠ±å‡½æ•°å®žçŽ°**
  - [ ] åŸºäºŽä»·æ ¼Ã—æµé‡è®¡ç®—å„agentæ”¶ç›Š
  - [ ] æž„å»ºå¥–åŠ±å­—å…¸è¿”å›žç»™PettingZooæŽ¥å£
  - [ ] éªŒè¯å¥–åŠ±è®¡ç®—çš„æ­£ç¡®æ€§

### ðŸ§ª Phase 7: æµ‹è¯•éªŒè¯ä¸Žä¼˜åŒ–ï¼ˆé¢„è®¡2å¤©ï¼‰
- [ ] **7.1 å……ç”µè¡Œä¸ºéªŒè¯**
  - [ ] ç¡®è®¤å……ç”µè½¦è¾†ä¸¥æ ¼æŒ‰é¢„å®šè·¯å¾„è¡Œé©¶
  - [ ] éªŒè¯è‡ªçŽ¯å……ç”µé“¾è·¯è®¿é—®ï¼šæ°å¥½ä¸€æ¬¡å……ç”µ
  - [ ] æ£€æŸ¥å……ç”µæµé‡ç»Ÿè®¡å‡†ç¡®æ€§

- [ ] **7.2 çŽ¯å¢ƒå®Œæ•´æ€§æµ‹è¯•**
  - [ ] å¤šè½®reset-stepå¾ªçŽ¯æµ‹è¯•
  - [ ] ä»·æ ¼æ”¶æ•›æœºåˆ¶éªŒè¯
  - [ ] PettingZooæŽ¥å£å…¼å®¹æ€§å…¨é¢æµ‹è¯•

- [ ] **7.3 æ€§èƒ½ä¼˜åŒ–**
  - [ ] UE-DTAæ±‚è§£æ•ˆçŽ‡åˆ†æžå’Œä¼˜åŒ–
  - [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–å’Œåžƒåœ¾å›žæ”¶
  - [ ] æ”¶æ•›å‚æ•°è°ƒä¼˜ï¼ˆé˜ˆå€¼ã€æ¦‚çŽ‡ç­‰ï¼‰

### ðŸ“š Phase 8: æ–‡æ¡£ä¸Žç¤ºä¾‹ï¼ˆé¢„è®¡1å¤©ï¼‰
- [ ] **8.1 APIæ–‡æ¡£å®Œå–„**
  - [ ] æ›´æ–°CLAUDE.mdä¸­çš„ä½¿ç”¨è¯´æ˜Ž
  - [ ] åˆ›å»ºçŽ¯å¢ƒä½¿ç”¨ç¤ºä¾‹è„šæœ¬
  - [ ] è®°å½•å…³é”®é…ç½®å‚æ•°è¯´æ˜Ž

- [ ] **8.2 åŸºå‡†æµ‹è¯•**
  - [ ] åˆ›å»ºæ ‡å‡†æµ‹è¯•åœºæ™¯
  - [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•å’ŒæŠ¥å‘Š
  - [ ] ä¸Žv1.0/v2.0çš„å¯¹æ¯”åˆ†æž

## ä¾èµ–é¡¹

- **UXSim**: äº¤é€šå¾®è§‚ä»¿çœŸæ¡†æž¶ (v1.8.2)
- **NetworkX**: è·¯å¾„è®¡ç®—çš„å›¾ç®—æ³•
- **PettingZoo**: å¤šæ™ºèƒ½ä½“å¼ºåŒ–å­¦ä¹ çŽ¯å¢ƒæ¡†æž¶
- **Gymnasium**: çŽ¯å¢ƒæŽ¥å£æ ‡å‡†
- **NumPy/Pandas**: æ•°æ®æ“ä½œå’Œåˆ†æž
- **PyTorch**: MADRLçš„æ·±åº¦å­¦ä¹ æ¡†æž¶
- **Matplotlib**: å¯è§†åŒ–å’Œç»˜å›¾

## é…ç½®æ–‡ä»¶å‚æ•°

çŽ¯å¢ƒä»Ž `siouxfalls_settings.json` è¯»å–é…ç½®ï¼š

```json
{
    // åŸºç¡€åšå¼ˆé…ç½®
    "charging_nodes": {"5": [0.1, 1.0], "12": [0.1, 1.0], "14": [0.1, 1.0], "18": [0.1, 1.0]},
    "charging_periods": 8,
    "charging_car_rate": 0.3,
    "routes_per_od": 5,
    
    // è‡ªçŽ¯å……ç”µé“¾è·¯ç‰©ç†å‚æ•°
    "charging_link_length": 3000,
    "charging_link_free_flow_speed": 10,
    
    // UE-DTAæ±‚è§£å‚æ•°
    "time_value_coefficient": 0.005,
    "charging_demand_per_vehicle": 50,
    "ue_convergence_threshold": 1.0,
    "ue_max_iterations": 100,
    "ue_swap_probability": 0.05,
    
    // ä»¿çœŸæŽ§åˆ¶å‚æ•°
    "simulation_time": 7200,
    "deltan": 5
}
```

## å…³é”®æŠ€æœ¯å†³ç­–è®°å½•

### v3.0 vs v1.0/v2.0 è®¾è®¡å¯¹æ¯”

| æ–¹é¢ | v1.0 (å……ç”µé“¾è·¯å¤åˆ¶) | v2.0 (èŠ‚ç‚¹åˆ†ç¦») | v3.0 (v2æ¡†æž¶+è‡ªçŽ¯+é¢„å®šè·¯å¾„) |
|------|-------------------|----------------|------------------------------|
| **æ•´ä½“æž¶æž„** | åŸºç¡€å®žçŽ° | å®Œæ•´PettingZooæ¡†æž¶ | ç»§æ‰¿v2æ¡†æž¶ |
| **å……ç”µé“¾è·¯** | å¤åˆ¶çŽ°æœ‰é“¾è·¯ä¸ºcharging_ç‰ˆæœ¬ | å†…éƒ¨é“¾è·¯è¿žæŽ¥åˆ†ç¦»èŠ‚ç‚¹ | çœŸæ­£è‡ªçŽ¯ï¼šidx->idx |
| **è·¯å¾„æŽ§åˆ¶** | ä¾èµ–UXSimè·¯å¾„é€‰æ‹© | å¤šçŠ¶æ€å›¾è·¯å¾„æŽ§åˆ¶ | å¤šçŠ¶æ€å›¾+PredefinedRouteVehicle |
| **ç½‘ç»œæ‹“æ‰‘** | é“¾è·¯æ•°ç¿»å€ | èŠ‚ç‚¹æ•°ç¿»å€+å†…éƒ¨é“¾è·¯ | ä»…å¢žåŠ è‡ªçŽ¯ï¼Œæœ€ç®€æ´ |
| **å……ç”µä¿è¯** | åŒå±‚å›¾æ¦‚çŽ‡ä¿è¯ | å¼ºåˆ¶æ°å¥½ä¸€æ¬¡ | é¢„å®šè·¯å¾„100%ä¿è¯ |
| **å®žçŽ°å¤æ‚åº¦** | ä¸­ç­‰ | é«˜ | ä¸­ç­‰ï¼ˆç»§æ‰¿v2æ¡†æž¶ï¼‰ |

### v3.0æ ¸å¿ƒä¼˜åŠ¿

1. **æž¶æž„æˆç†Ÿ**: ç»§æ‰¿v2çš„å®Œæ•´PettingZooæŽ¥å£å’ŒUE-DTAæ¡†æž¶ï¼Œé¿å…é‡å¤å¼€å‘
2. **æ‹“æ‰‘æœ€ç®€**: è‡ªçŽ¯å……ç”µé“¾è·¯æ˜¯æ‰€æœ‰æ–¹æ¡ˆä¸­ç½‘ç»œæ‹“æ‰‘æœ€ç®€æ´çš„
3. **æŽ§åˆ¶ç²¾ç¡®**: å¤šçŠ¶æ€å›¾+é¢„å®šè·¯å¾„åŒé‡ä¿è¯å……ç”µè¡Œä¸ºçš„ç¡®å®šæ€§
4. **æ‰©å±•ä¾¿åˆ©**: åŸºäºŽv2æ¡†æž¶ï¼Œæ˜“äºŽåŽç»­åŠŸèƒ½æ‰©å±•å’Œç®—æ³•é›†æˆ
5. **éªŒè¯å……åˆ†**: PredefinedRouteVehicleå·²é€šè¿‡æŠ€æœ¯éªŒè¯ï¼Œç¡®ä¿è·¯å¾„æ‰§è¡Œå¯é æ€§

### éšæœºç§å­ç®¡ç†ç­–ç•¥

- **çŽ¯å¢ƒåˆå§‹åŒ–**: ä¼ å…¥ç»Ÿä¸€random_seedå‚æ•°æŽ§åˆ¶æ‰€æœ‰éšæœºæ“ä½œ
- **ä»·æ ¼åˆå§‹åŒ–**: ä½¿ç”¨ç§å­æŽ§åˆ¶åˆå§‹ä»·æ ¼ç”Ÿæˆ
- **UXSimä»¿çœŸ**: æ¯è½®è®¾ç½®ç›¸åŒç§å­ç¡®ä¿å¯å¤çŽ°æ€§
- **è·¯å¾„åˆ‡æ¢**: UEç®—æ³•ä¸­çš„éšæœºåˆ‡æ¢ä½¿ç”¨ç§å­æŽ§åˆ¶

## å¼€å‘æ³¨æ„äº‹é¡¹

- é¡¹ç›®å…¨ç¨‹ä½¿ç”¨ä¸­æ–‡æ³¨é‡Šå’Œå˜é‡å
- é»˜è®¤é…ç½®INFOçº§åˆ«æ—¥å¿—ï¼Œå…³é”®æ­¥éª¤è¾“å‡ºè°ƒè¯•ä¿¡æ¯
- çŽ¯å¢ƒæ”¯æŒå……ç”µå’Œéžå……ç”µè½¦è¾†æ··åˆä»¿çœŸ
- ä½¿ç”¨çŽ¯å¢ƒåˆå§‹åŒ–å‚æ•°ä¸­çš„éšæœºç§å­è¿›è¡Œå®Œå…¨å¯å¤çŽ°çš„ä»¿çœŸ
- v3.0å®žçŽ°ä½äºŽ `src/EVCSChargingGameEnv.py`ï¼Œä¿æŒä¸Žé…ç½®æ–‡ä»¶æ ¼å¼å®Œå…¨å…¼å®¹
- ä¸¥æ ¼éµå¾ªPettingZoo ParallelEnvæŽ¥å£è§„èŒƒï¼Œç¡®ä¿MADRLç®—æ³•å…¼å®¹æ€§
- å……ç”µé“¾è·¯å‘½åè§„èŒƒï¼š`charging_{node_idx}` ç”¨äºŽè‡ªçŽ¯é“¾è·¯ `{node_idx} -> {node_idx}`