# 柏林路网简化数据集 - 完成记录

## 1. 数据集概览

已完成 `berlin_friedrichshain_simplified` 数据集构建。

| 指标 | 数值 |
|-----|------|
| 节点数 | 191 |
| 链路数 | 451 |
| OD对数 | 506 |
| 充电站数 | 20 |
| 路网总长度 | 167.8 km |

## 2. 关键参数

### 2.1 空间聚合
- **聚合阈值**: 50.0m
- **节点缩减**: 224 → 191 (减少 14.7%)

### 2.2 需求倍数
经过仿真测试，确定最佳需求倍数：

| 倍数 | 完成率 | 平均速度 | 延误比 | 评价 |
|-----|-------|---------|-------|------|
| 1x | 100% | 28.0 m/s | 14% | 无拥堵 |
| 3x | 100% | 10.5 m/s | 78% | 轻度拥堵 |
| **3.5x** | **100%** | **7.4 m/s** | **88%** | **推荐** |
| 4x | 81% | 4.1 m/s | 93% | 较重拥堵 |
| 5x | 42% | 2.5 m/s | 92% | 严重拥堵 |

**推荐配置**: `demand_multiplier = 3.5`
- 100% 完成率
- 明显的高峰拥堵效果
- 仿真结束前网络可恢复

## 3. 文件结构

```
berlin_friedrichshain_simplified/
├── nodes.csv          # 节点坐标
├── links.csv          # 链路数据 (name, start, end, length, u, kappa)
├── demand.csv         # OD需求 (orig, dest, start_t, end_t, q)
├── settings.json      # 仿真配置 (含20个充电站)
└── uxsim.py           # UXSim源码参考
```

## 4. 使用方式

```python
# 测试脚本
python test_berlin_simplified.py

# 在博弈环境中使用时，需要放大需求
demand_multiplier = 3.5
W.adddemand(orig, dest, start_t, end_t, q * demand_multiplier)
```

## 5. 进阶实验与数据集扩展规划

### 5.1 Berlin Friedrichshain (BF) 优化策略

**定位**: 真实场景模拟、数字孪生展示、微观博弈特征验证。

**挑战**: BF 路网呈现微观"管状"车流特征（OD 稀疏），随机放置的充电站极易因不在特定通勤路径上而导致**零流量**，使智能体无法学习。

**执行方案**:
1.  **维持压力**: 严格锁定 `demand_multiplier = 3.5`。
    *   *注*: 实测 4x 以上会导致网络完全死锁（Gridlock），无法进行有效的博弈仿真。
2.  **智能选址 (Smart Placement)**: ✅ 已完成
    *   先运行一次无博弈的纯交通仿真。
    *   统计全网 Link 的累计通行流量。
    *   将充电站部署在**流量最大的 Top 20 节点**上（而非随机分布）。
    *   *目的*: 确保博弈有"生源"，观察主干道拥堵时支路站点的定价引流策略。

#### 5.1.1 智能选址分析结果 (2024-12)

**分析方法对比**:

| 方案 | 方法 | 与原方案重叠 | 流量覆盖 | 提升 |
|-----|------|------------|---------|------|
| 原方案 | 基于节点度数 | - | 822,175 车次 | 基准 |
| 方案A | 基于链路流量Top20端点 | 2个 | 1,102,650 车次 | +34.1% |
| **方案B** | **基于节点流量Top20** | **3个** | **1,591,275 车次** | **+93.5%** |

**最终选址 (方案B - 已采用)**:

节点ID: `3, 12, 21, 39, 42, 46, 56, 58, 59, 64, 68, 79, 105, 107, 124, 154, 163, 165, 167, 172`

**Top 10 高流量节点**:

| 排名 | 节点 | 流量(车次) |
|-----|------|-----------|
| 1 | 107 | 110,600 |
| 2 | 163 | 110,500 |
| 3 | 172 | 100,400 |
| 4 | 39 | 94,450 |
| 5 | 58 | 94,250 |
| 6 | 12 | 82,550 |
| 7 | 56 | 81,600 |
| 8 | 167 | 80,150 |
| 9 | 21 | 73,175 |
| 10 | 59 | 72,900 |

**分析工具**: `analyze_station_placement.py`
**可视化输出**: `data/berlin_friedrichshain/station_placement_comparison.png`

### 5.2 待引入数据集：Anaheim

**定位**: **规模泛化验证**。作为 Sioux Falls (理论) 到 Berlin (真实) 之间的“中型进阶算例”。

**特征**:
*   **来源**: `bstabler/TransportationNetworks` (TNTP格式)
*   **规模**: 416 节点 / 914 链路 / 38 交通小区 (Zones)。
*   **优势**: 
    *   结构比 SF 更真实，包含清晰的主干道层级。
    *   需求基于区域对 (Zone-to-Zone)，比 BF 的点对点 (Point-to-Point) 需求分布更均匀，天然具备良好的连通性，无需过度依赖需求倍增。
*   **任务**:
    *   TNTP 格式清洗与转换 (坐标归一化、容量/需求单位换算)。
    *   验证 MADDPG 在 400+ 节点规模下的收敛性。
